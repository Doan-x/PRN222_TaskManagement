@model IEnumerable<PRN222_TaskManagement.Models.Event>

@{
    ViewData["Title"] = "Sự kiện hôm nay";
    var categories = ViewData["Categories"] as List<Category>;
}

<div class="container">
    <h2>Sự kiện dang dien ra</h2>

    <!-- Form lọc và sắp xếp -->
    <form method="get" class="mb-3">
        <div class="row mt-3">
            <div class="col-md-3">
                <label>Chọn danh mục:</label>
                <select name="categoryId" class="form-control">
                    <option value="">-- Tất cả --</option>
                    @foreach (var c in categories)
                    {
                        <option value="@c.CategoryId"> @c.Name</option>

                    }
                </select>
            </div>
            <div class="col-md-3">
                <label>Chọn mức độ ưu tiên:</label>
                <select name="priority" class="form-control">
                    <option value="">-- Tất cả --</option>
                    <option value="high">Cao</option>
                    <option value="medium">Trung bình</option>
                    <option value="low">Thấp</option>
                </select>
            </div>
            <div class="col-md-3">
                <label>Sắp xếp theo:</label>
                <select name="sortField" class="form-control">
                    <option value="start_time">Thời gian bắt đầu</option>
                    <option value="priority">Độ ưu tiên</option>
                </select>
            </div>
            <div class="col-md-3">
                <label>Thứ tự:</label>
                <select name="sortDirection" class="form-control">
                    <option value="asc">Tăng dần</option>
                    <option value="desc">Giảm dần</option>
                </select>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-12 text-right">
                <button type="submit" class="btn btn-primary">Áp dụng</button>
            </div>
        </div>
    </form>
    <div class="row">
        <div class="col">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">
                    @TempData["Success"]
                </div>
            }

            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">
                    @TempData["Error"]
                </div>
            }
        </div>
    </div>
    <!-- Hiển thị bảng sự kiện -->
    @if (Model != null && Model.Any())
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Start Time</th>
                    <th>Date Time</th>
                    <th>Category</th>
                    <th>Location</th>
                    <th>Priority</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var eventItem in Model)
                {
                    <tr>
                        <td>@eventItem.Title</td>
                        <td>@eventItem.StartTime.ToString("yyyy-MM-dd") <strong>@eventItem.StartTime.ToString("HH:mm")</strong></td>
                        <td>@eventItem.EndTime.ToString("yyyy-MM-dd") <strong>@eventItem.EndTime.ToString("HH:mm")</strong></td>
                        <td>@(eventItem.Category == null ? "N/A" : eventItem.Category.Name) </td>
                        <td>@eventItem.Location</td>
                        <td>
                            <span class="badge text-bg-@GetPriorityClass(eventItem.Priority)">
                                @eventItem.Priority
                            </span>
                        </td>
                        <td>                         
                            <a href="@Url.Action("Delete", "Event", new { id = eventItem.EventId, returnUrl = @Context.Request.Path })" class="btn btn-sm btn-danger">Delete</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>Không có sự kiện nào trong hôm nay.</p>
    }
</div>

<script type="text/javascript">
    setTimeout(function () {
        $(".alert").fadeOut("slow");
    }, 3000);


</script>

@functions {
    string GetPriorityClass(string priority)
    {
        return priority switch
        {
            "high" => "danger",
            "medium" => "warning",
            "low" => "success",
            _ => "secondary"
        };
    }
}